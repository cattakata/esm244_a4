---
title: "Parameter Estimation – Wild Fish Catch"
author: "Catherine Takata"
date: "3/2/2021"
output: 
  html_document:
    theme: cerulean
    code_folding: show
    toc: true
---

## Summary 
We will identify an equation with parameters estimated by nonlinear least squares for the increase in global wild fish catch from 1950 – 2012.

**Source**: Global wild fish catch and aquaculture production, compiled by Earth Policy Institute with 1950-2010 from U.N. Food and Agriculture Organization (FAO), Global Capture Production and Global Aquaculture Production, electronic databases, at www.fao.org/fishery/topic/16140/en.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(boot)
library(patchwork)
library(broom)
library(nlstools)
```

```{r}
# Read in data 
fish_catch <- read.csv(here("a4_task2", "data", "fish_catch.csv"), col.names = c("year", "wild_catch", "farmed_fish", "total_fish_production")) %>% 
  mutate(time = year) 

fish_catch[1:63, 5] = c(0:62)
```


## Exploratory Graph

```{r}
ggplot(data = fish_catch, aes(x = year, y = wild_catch)) +
  geom_point() +
  theme_minimal() +
  labs(title = "Wild catch from 1950-2012",
       x = "time (years)", 
       y = "wild catch (million tons)") 
```

```{r}
ggplot(data = fish_catch, aes(x = year, y = log(wild_catch))) +
  geom_point() +
  theme_minimal() +
  labs(title = "Wild catch from 1950-2012",
       x = "time (years)", 
       y = "ln(wild catch)") 
```


What type of relationship describes the trend? 
- Logistic growth of a population over time 

What does that look like mathematically (include an equation, possibly using LaTeX)? What are your initial estimates for the parameters in the model? 
- inital estimates of K come from the point at which resrouces stop supporting growth of population once it reaches carring capacity 
- at point where graph levels out 


## Inital Estimates 

```{r}
# Estimate the growth rate constant (k) *during exponential growth phase)
fish_est <- fish_catch %>%
  filter(wild_catch < 95) %>% 
  mutate(ln_wild_catch = log(wild_catch))

# Model linear to get *k* estimate (the slope of this linear equation is an estimate of the growth rate constant
lm_k <- lm(ln_wild_catch ~ time, data = fish_est)
lm_k
```

We have initial estimate for k (0.03), and we can estimate K ~ 95 and A ~ 4.3.

## Parameter Outcomes 

Nonlinear least squares converges on parameter estimates that minimize the the sum of squares of residuals through an iterative algorithm

```{r}
fish_nls <- nls(wild_catch ~ K/(1 + A*exp(-r*time)),
              data = fish_catch,
              start = list(K = 95, A = 4.3, r = 0.03),
              trace = TRUE
              )
```

```{r}
#See the model summary (null hypothesis: parameter value = 0)
summary(fish_nls)

# Use broom:: functions to get model outputs in tidier format: 
model_out <- broom::tidy(fish_nls) 

# Want to just get one of these?  
A_est <- model_out$estimate[2] # Gets the first rown 
```

Our model with estimated parameters is:
$$P(t) = \frac{100.3}{1+4.3e^{-0.06t}}$$

## Finalized Results 

```{r}
# Make predictions for the population at all of those times (time) in the original df: 
p_predict <- predict(fish_nls)

# Bind predictions to original data frame:
fish_complete <- data.frame(fish_catch, p_predict)

# Plot them all together:
ggplot(data = fish_complete, aes(x = year, y = wild_catch)) +
  geom_point() +
  geom_line(aes(x = year, y = p_predict)) +
  theme_minimal()
```






